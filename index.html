<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>امتحان مادة اللغة العربية — إعداد: هيثم العبيديين</title>
<style>
html,body{height:100%;margin:0;font-family:"Tajawal","Noto Sans Arabic",sans-serif}
body{display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#fff,#ffe6f0);color:#222;}
.wrap{width:100%;max-width:980px;padding:20px;box-sizing:border-box;}
.card{background:#fff;border-radius:14px;padding:26px;box-shadow:0 12px 38px rgba(10,10,20,0.12);}
h1{margin:0 0 6px;font-size:26px;text-align:center}
.sub{color:#666;text-align:center;margin-bottom:14px}
.duaa{font-size:18px;text-align:center;margin-bottom:18px;color:#333}
.centered{display:flex;align-items:center;justify-content:center;flex-direction:column;gap:12px}
input[type="text"]{width:100%;padding:12px;border-radius:10px;border:1px solid #e6e6e6;font-size:18px;box-sizing:border-box}
button{background:#f06292;color:#fff;border:0;padding:12px 18px;border-radius:10px;font-size:17px;font-weight:700;cursor:pointer}
button[disabled]{background:#f5c2d3;color:#fff;opacity:0.6;cursor:not-allowed}
.exam-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.exam-header .left{font-size:16px;color:#555}
.timer{background:#ffe6f0;color:#b91c5a;padding:8px 12px;border-radius:8px;font-weight:800}
.qbox{margin-top:8px}
.qindex{color:#666;margin-bottom:8px}
.qtext{font-size:19px;margin-bottom:10px;font-weight:600}
.options{display:flex;flex-direction:column;gap:8px}
.option{display:flex;align-items:center;gap:10px;padding:10px;border-radius:8px;border:1px solid #f0f0f0;font-size:17px}
.option input{transform:scale(1.25);margin-left:8px}
.nav{display:flex;justify-content:space-between;margin-top:16px;gap:8px}
.nav button{flex:1}
.hidden{display:none !important}
.result-wrap{display:flex;align-items:center;justify-content:center}
.result-card{width:100%;max-width:820px;background:#fff;border-radius:12px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,0.08)}
.score{font-size:22px;font-weight:800;text-align:center;margin-bottom:12px}
.questions-review{margin-top:14px}
.q-block{padding:12px;border-radius:10px;border:1px solid #faf0f5;background:#fff;margin-bottom:12px}
.q-block .q-title{font-weight:700;margin-bottom:8px}
.opt{padding:8px;border-radius:8px;margin-bottom:6px}
.opt.correct{background:#ecfdf5;color:#065f46;font-weight:700;border:1px solid rgba(16,185,129,0.12)}
.opt.wrong{background:#fff1f2;color:#7f1d1d;font-weight:700;border:1px solid rgba(220,38,38,0.08)}
.small{color:#666;font-size:14px}
.q-block,.opt{font-size:16px}
@media (max-width:640px){
  .card{padding:18px}
  h1{font-size:20px}
  .qtext{font-size:17px}
  .option{font-size:15px}
  .opt{font-size:15px}
}
</style>
</head>
<body>
<div class="wrap">
  <div id="startCard" class="card centered">
    <h1>امتحان مادة اللغة العربية</h1>
    <div class="sub">مدة الامتحان: ساعة واحدة — إعداد: <strong>هيثم العبيديين</strong></div>
    <div class="duaa">"اللهم إني استودعتك حفظي ووردي فرده لي وقت حاجتي"</div>
    <div style="width:100%;max-width:680px">
      <label class="small">اسم الطالب (3 مقاطع على الأقل)</label>
      <input id="studentName" type="text" placeholder="اكتب اسم الطالب هنا" />
      <div style="height:10px"></div>
      <div style="text-align:center">
        <button id="startBtn" disabled>ابدأ الامتحان</button>
      </div>
    </div>
  </div>

  <div id="examCard" class="card hidden">
    <div class="exam-header">
      <div class="left">الطالب: <strong id="displayName"></strong></div>
      <div class="timer" id="mainTimer">60:00</div>
    </div>

    <div class="qbox">
      <div class="qindex">السؤال <span id="currentIndex">1</span> من <span id="totalCount">50</span></div>
      <div id="questionArea"></div>
      <div class="nav" id="navButtons">
        <button id="prevBtn">السابق</button>
        <button id="nextBtn">التالي</button>
        <button id="submitBtn" class="hidden" disabled>عرض النتيجة</button>
      </div>
    </div>
  </div>

  <div id="resultContainer" class="hidden" style="margin-top:16px"></div>
</div>

<script>
const questions = [
  {q:"السؤال الأول: مثال", opts:["أ) خيار1","ب) خيار2","ج) خيار3","د) خيار4"], correct:0},
  {q:"السؤال الثاني: مثال", opts:["أ) خيار1","ب) خيار2","ج) خيار3","د) خيار4"], correct:1},
  {q:"السؤال الثالث: مثال", opts:["أ) خيار1","ب) خيار2","ج) خيار3","د) خيار4"], correct:2}
];

// خلط ترتيب الأسئلة
function shuffle(array){for(let i=array.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]];}return array;}

let state = {name:'',order:[],answers:{},current:0,totalTime:3600,remain:3600,timerInterval:null,finished:false};
const startCard = document.getElementById('startCard');
const examCard = document.getElementById('examCard');
const resultContainer = document.getElementById('resultContainer');
const studentNameInput = document.getElementById('studentName');
const startBtn = document.getElementById('startBtn');
const displayName = document.getElementById('displayName');
const mainTimer = document.getElementById('mainTimer');
const currentIndex = document.getElementById('currentIndex');
const totalCount = document.getElementById('totalCount');
const questionArea = document.getElementById('questionArea');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const submitBtn = document.getElementById('submitBtn');

totalCount.textContent = questions.length;

studentNameInput.addEventListener('input',()=>{
  const parts = studentNameInput.value.trim().split(/\s+/).filter(s=>s.length>0);
  startBtn.disabled = (parts.length<3);
});

startBtn.addEventListener('click',()=>{state.name=studentNameInput.value.trim();startExam();});

function startExam(){
  state.order = shuffle(Array.from(Array(questions.length).keys()));
  state.answers = {};
  state.current = 0;
  state.remain = state.totalTime;
  state.finished = false;
  startCard.classList.add('hidden');examCard.classList.remove('hidden');resultContainer.classList.add('hidden');
  displayName.textContent=state.name;currentIndex.textContent=state.current+1;totalCount.textContent=questions.length;
  renderQuestion();
  if(state.timerInterval) clearInterval(state.timerInterval);
  state.timerInterval=setInterval(()=>{state.remain--;updateTimer();if(state.remain<=0){clearInterval(state.timerInterval);state.remain=0;updateTimer();finalizeAndShowResults();}},1000);
}

function updateTimer(){const m=Math.floor(state.remain/60);const s=state.remain%60;mainTimer.textContent=`${m}:${String(s).padStart(2,'0')}`;}

function renderQuestion(){
  const ord=state.order[state.current];const q=questions[ord];
  currentIndex.textContent=state.current+1;
  questionArea.innerHTML='';
  const qText=document.createElement('div');qText.className='qtext';qText.textContent=q.q;questionArea.appendChild(qText);
  const optsDiv=document.createElement('div');optsDiv.className='options';
  q.opts.forEach((opt,idx)=>{
    const label=document.createElement('label');label.className='option';
    label.innerHTML=`<input type="radio" name="opt" value="${idx}" ${state.answers[ord]===idx?'checked':''} /> <span>${opt}</span>`;
    label.querySelector('input').addEventListener('change',(e)=>{
      if(state.finished) return;
      state.answers[ord]=parseInt(e.target.value,10);
      updateSubmitBtn();
    });
    optsDiv.appendChild(label);
  });
  questionArea.appendChild(optsDiv);

  prevBtn.disabled=(state.current===0)||state.finished;
  nextBtn.disabled=(state.current===questions.length-1)||state.finished;

  // زر عرض النتيجة يظهر فقط عند آخر سؤال
  if(state.current === questions.length-1){submitBtn.classList.remove('hidden');} else {submitBtn.classList.add('hidden');}
  updateSubmitBtn();
}

prevBtn.addEventListener('click',()=>{if(state.finished)return;if(state.current>0){state.current--;renderQuestion();}});
nextBtn.addEventListener('click',()=>{if(state.finished)return;if(state.current<questions.length-1){state.current++;renderQuestion();}});

function updateSubmitBtn(){
  const allAnswered=state.order.every(i=>state.answers.hasOwnProperty(i));
  submitBtn.disabled=!allAnswered;
}

submitBtn.addEventListener('click',()=>{finalizeAndShowResults();});

function finalizeAndShowResults(){
  if(state.finished) return;
  state.finished=true;
  if(state.timerInterval) clearInterval(state.timerInterval);
  examCard.classList.add('hidden');
  const result=computeResult();
  showResultCard(result);
}

function computeResult(){
  let correctCount=0;
  const review=[];
  for(let i=0;i<state.order.length;i++){
    const orig=state.order[i];
    const q=questions[orig];
    const chosen=state.answers.hasOwnProperty(orig)?state.answers[orig]:null;
    if(chosen!==null && chosen===q.correct) correctCount++;
    review.push({qnum:i+1,origIndex:orig,questionText:q.q,opts:q.opts,chosenIndex:chosen,correctIndex:q.correct});
  }
  return {correctCount,total:questions.length,review};
}

function showResultCard(result){
  resultContainer.classList.remove('hidden');resultContainer.innerHTML='';

  const wrapper=document.createElement('div');wrapper.className='result-wrap';
  const card=document.createElement('div');card.className='result-card';

  // أعلى النتيجة فقط أولاً
  const score=document.createElement('div');score.className='score';
  score.innerHTML=`الطالب: <strong>${escapeHtml(state.name)}</strong> — المعلم: <strong>هيثم العبيديين</strong><br>النتيجة: <strong>${result.correctCount} / ${result.total}</strong>`;
  card.appendChild(score);

  // مراجعة الأسئلة تظهر عند النزول
  const reviewDiv=document.createElement('div');reviewDiv.className='questions-review';
  result.review.forEach(item=>{
    const block=document.createElement('div');block.className='q-block';
    const title=document.createElement('div');title.className='q-title';
    title.textContent=`السؤال ${item.qnum}: ${item.questionText}`;block.appendChild(title);
    item.opts.forEach((optText,idx)=>{
      const optEl=document.createElement('div');
      if(idx===item.correctIndex){optEl.className='opt correct';optEl.textContent=optText+' (الإجابة النموذجية)';}
      else if(item.chosenIndex===idx && idx!==item.correctIndex){optEl.className='opt wrong';optEl.textContent=optText+' ← إجابتك';}
      else{optEl.className='opt';optEl.textContent=optText;}
      block.appendChild(optEl);
    });
    reviewDiv.appendChild(block);
  });
  card.appendChild(reviewDiv);
  wrapper.appendChild(card);resultContainer.appendChild(wrapper);

  disableAllInteractions();
}

function disableAllInteractions(){
  document.querySelectorAll('input[type="radio"]').forEach(i=>i.disabled=true);
  prevBtn.disabled=true;nextBtn.disabled=true;submitBtn.disabled=true;
}

function escapeHtml(unsafe){return unsafe.replace(/[&<"']/g,function(m){switch(m){case '&':return'&amp;';case '<':return'&lt;';case '"':return'&quot;';case "'":return'&#039;';default:return m;}});}
</script>
</body>
</html>
